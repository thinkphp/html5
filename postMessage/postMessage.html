<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
   <title></title>
   <style type="text/css">
   </style>
   <script src="http://www.google.com/jsapi?key=ABQIAAAA1XbMiDxx_BTCY2_FkPh06RRaGTYH6UMl8mADNa0YKuWNNa8VNxQEerTAUcfkyrr6OwBovxn7TDAH5Q"></script>
   <script type="text/javascript">google.load("mootools", "1.3");</script>
</head>
<body>
<input type="button" value="doit" id="post"/>
<iframe id="iframe" src="http://aldovet.ro/html5/postMessage/postMessage-target.html"></iframe>

   <script type="text/javascript">

   var addEvent = (function(){
       if(document.addEventListener) {
          return function(el, evType, fn, useCapture) {
                 if(el && el.nodeName  || el == window) {
                    el.addEventListener(evType, fn, useCapture); 
                 } else if(el && el.length){
                   for(var i=0; i < el.length;i++) {
                       addEvent(el[i], evType, fn, useCapture);
                   }
                 }
          };
       } else {
       }   
   })();

 
  addEvent(window,'message', function(event){

        if(event.origin !== "http://aldovet.ro") {return;}

        console.log("Received response from "+ event.origin + ' re: ' + event.data);

  }, false);


  var domain = "http://aldovet.ro";

  addEvent(document.getElementById("post"),'click', function(event){

    var iframe = document.getElementById("iframe").contentWindow,
        message = "Hello Word (time is " + (new Date().getTime()) + ')';
  
    console.log("Sending message: " + message);
    iframe.postMessage(message, domain); 

  },false);

  </script>

</body>
</html>